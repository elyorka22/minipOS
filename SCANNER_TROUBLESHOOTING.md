# Решение проблемы "Сканер не работает"

## Шаг 1: Проверьте консоль браузера

1. Откройте приложение в браузере
2. Нажмите **F12** (или ПКМ → "Проверить элемент")
3. Перейдите на вкладку **"Console"**
4. Обновите страницу (Ctrl+F5 или Cmd+Shift+R)

### Что должно появиться при загрузке:

✅ **Хорошие признаки:**
```
✅ Библиотека html5-qrcode загружена успешно
Библиотека html5-qrcode загружена, версия: 2.3.8
Запуск сканера с настройками: {...}
✓ Сканер успешно запущен
```

❌ **Плохие признаки:**
```
❌ Библиотека html5-qrcode не загружена!
Error: Библиотека html5-qrcode не загружена
Error: Html5QrcodeSupportedFormats не определен
```

## Шаг 2: Проверьте работу камеры

1. Откройте экран "Продажа" или "Принять товар"
2. Должна открыться камера
3. В консоли должно появиться:
```
Запуск сканера...
✓ Сканер успешно запущен
```

### Если камера не открывается:

- Проверьте разрешения браузера на доступ к камере
- Убедитесь, что сайт открыт через HTTPS (Railway предоставляет автоматически)
- Закройте другие приложения, использующие камеру

## Шаг 3: Проверьте распознавание штрих-кода

1. Наведите камеру на штрих-код
2. В консоли должно появиться:
```
=== Штрих-код распознан ===
Текст: 1234567890123
Тип: EAN_13
Длина: 13
Нормализованный: 1234567890123
Валидация: {valid: true}
Вызываем onSuccess с кодом: 1234567890123
```

### Если код не распознается:

**Проверьте:**
- Освещение (должно быть хорошее)
- Расстояние (10-20 см от штрих-кода)
- Угол камеры (держите ровно, без наклона)
- Четкость штрих-кода (не поврежден, не размыт)

**В консоли могут появляться ошибки:**
```
Ошибка сканирования: NotFoundException
Ошибка сканирования: QR code parse error
```
Это нормально - библиотека пытается распознать код в каждом кадре.

## Шаг 4: Проверьте обработку результата

Если код распознается (появляется в консоли), но не обрабатывается:

1. Проверьте сообщения в консоли
2. Если есть предупреждения валидации - код все равно должен обрабатываться
3. Проверьте, что товар существует в базе данных

## Частые проблемы и решения

### Проблема 1: Библиотека не загружается

**Ошибка:** `❌ Библиотека html5-qrcode не загружена!`

**Решение:**
- Проверьте интернет-соединение
- Проверьте, что сайт открыт через HTTPS
- Попробуйте обновить страницу (Ctrl+F5)

### Проблема 2: Камера не открывается

**Ошибка:** `Permission denied` или `NotAllowedError`

**Решение:**
1. В настройках браузера разрешите доступ к камере
2. Для Chrome на Android: Настройки → Сайты → Камера → Разрешить
3. Обновите страницу и попробуйте снова

### Проблема 3: Штрих-код не распознается

**Признаки:** Камера работает, но код не распознается

**Решения:**
1. Улучшите освещение
2. Держите камеру на расстоянии 10-20 см
3. Держите камеру ровно, без наклона
4. Убедитесь, что штрих-код четкий и не поврежден
5. Попробуйте другой штрих-код для проверки

### Проблема 4: Код распознается, но не обрабатывается

**Признаки:** В консоли видно "Штрих-код распознан", но товар не добавляется

**Проверьте:**
1. Сообщения в консоли о валидации
2. Есть ли товар в базе данных с таким штрих-кодом
3. Нет ли ошибок в консоли после распознавания

## Диагностика через консоль

Откройте консоль браузера и выполните:

```javascript
// Проверка библиотеки
console.log('Html5Qrcode:', typeof Html5Qrcode);
console.log('Html5QrcodeSupportedFormats:', typeof Html5QrcodeSupportedFormats);

// Проверка сканера
console.log('currentScanner:', currentScanner);

// Проверка камеры
navigator.mediaDevices.getUserMedia({ video: true })
  .then(stream => {
    console.log('✓ Камера доступна');
    stream.getTracks().forEach(track => track.stop());
  })
  .catch(err => {
    console.error('✗ Камера недоступна:', err);
  });
```

## Получение помощи

Если проблема не решена:

1. Откройте консоль браузера (F12)
2. Скопируйте все сообщения из консоли
3. Укажите:
   - Какая ошибка появляется
   - Что видно в консоли при попытке сканирования
   - На каком устройстве тестируете (Android, iOS, Desktop)
   - Какой браузер используете

## Быстрая проверка

1. ✅ Библиотека загружена (проверка в консоли)
2. ✅ Камера открывается
3. ✅ В консоли появляются сообщения при сканировании
4. ✅ Штрих-код распознается (появляется в консоли)
5. ✅ Товар обрабатывается

Если все пункты ✅ - сканер работает правильно!

